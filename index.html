<!DOCTYPE html>
<html lang="ru">
    <head>
    <link rel="stylesheet" href="./css/style.css">
    <link rel="stylesheet" href="./css/history.css">
    </head>

    <body>
        <main>
        <div class="pos_chess">
        <div class="row">
            <div class="white"><img/></div>
            <div class="black"><img></div>
            <div class="white"><img></div>
            <div class="black"><img></div>
            <div class="white"><img></div>
            <div class="black"><img></div>
            <div class="white"><img></div>
            <div class="black"><img></div>
            <span class="label">8</span>
        </div>
        <div class="row">
            <div class="black"><img></div>
            <div class="white"><img></div>
            <div class="black"><img></div>
            <div class="white"><img></div>
            <div class="black"><img></div>
            <div class="white"><img></div>
            <div class="black"><img></div>
            <div class="white"><img></div>
            <span class="label">7</span>
        </div>
        <div class="row">
            <div class="white"><img></div>
            <div class="black"><img></div>
            <div class="white"><img></div>
            <div class="black"><img></div>
            <div class="white"><img></div>
            <div class="black"><img></div>
            <div class="white"><img></div>
            <div class="black"><img></div>
            <span class="label">6</span>
        </div>
        <div class="row">
            <div class="black"><img></div>
            <div class="white"><img></div>
            <div class="black"><img></div>
            <div class="white"><img></div>
            <div class="black"><img></div>
            <div class="white"><img></div>
            <div class="black"><img></div>
            <div class="white"><img></div>
            <span class="label">5</span>
        </div>
        <div class="row">
            <div class="white"><img></div>
            <div class="black"><img></div>
            <div class="white"><img></div>
            <div class="black"><img></div>
            <div class="white"><img></div>
            <div class="black"><img></div>
            <div class="white"><img></div>
            <div class="black"><img></div>
            <span class="label">4</span>
        </div>
        <div class="row">
            <div class="black"><img></div>
            <div class="white"><img></div>
            <div class="black"><img></div>
            <div class="white"><img></div>
            <div class="black"><img></div>
            <div class="white"><img></div>
            <div class="black"><img></div>
            <div class="white"><img></div>
            <span class="label">3</span>
        </div>
        <div class="row">
            <div class="white"><img></div>
            <div class="black"><img></div>
            <div class="white"><img></div>
            <div class="black"><img></div>
            <div class="white"><img></div>
            <div class="black"><img></div>
            <div class="white"><img></div>
            <div class="black"><img></div>
            <span class="label">2</span>
        </div>
        <div class="row">
            <div class="black"><img></div>
            <div class="white"><img></div>
            <div class="black"><img></div>
            <div class="white"><img></div>
            <div class="black"><img></div>
            <div class="white"><img></div>
            <div class="black"><img></div>
            <div class="white"><img></div>
            <span class="label">1</span>
        </div> 
        <div class="captions">
            <div class="label2">a</div>
            <div class="label2">b</div>
            <div class="label2">c</div>
            <div class="label2">d</div>
            <div class="label2">e</div>
            <div class="label2">f</div>
            <div class="label2">g</div>
            <div class="label2">h</div>
        </div>
    </div>
    <div class="history-container">
        <h1 class="history-title">История ходов</h1>
        <ol class="history-list">
            <li class="history-element">
                123 123
            </li>
            <li class="history-element">
                123 123
            </li>
            <li class="history-element">
                123 123
            </li>
            <li class="history-element">
                123 123
            </li>
            <li class="history-element">
                123 123
            </li>
            <li class="history-element">
                123 123
            </li>
            <li class="history-element">
                123 123
            </li>
            <li class="history-element">
                123 123
            </li>
            <li class="history-element">
                123 123
            </li>
            <li class="history-element">
                123 123
            </li>
            <li class="history-element">
                123 123
            </li>
            <li class="history-element">
                123 123
            </li>
            <li class="history-element">
                123 123
            </li>
            <li class="history-element">
                123 123
            </li>
            <li class="history-element">
                123 123
            </li>
            <li class="history-element">
                123 123
            </li>
        </ol>
    </div>
    </main>
    <script>
        let rows = document.querySelectorAll('.row')
        let board = []
        for (let i =0;i<8;i++) {
            board.push([null,null,null,null, null,null, null,null ])
        }
        class Figure  {
            constructor (x, y, isWhite, image ){
                this.x =x
                this.y =y
                board[x][y] = this
                this.isWhite = isWhite
                this.image = `./src/${ this.isWhite? 'white':'black' }_${image}.png` 
            }
            draw () {
                let row = rows[7-this.y]
                let div = row.querySelectorAll('div')[this.x]
                let image = div.querySelector('img')
                image.src = this.image
                image.style.opacity = 1
            }
        }

        class Pawn extends Figure {
            constructor (x, y, isWhite) {
                super(x, y, isWhite, 'pawn')
            }
        }

        class Rook extends Figure {
            constructor (x, y, isWhite) {
                super(x, y, isWhite, 'rook')
            }
        }
        
        class King extends Figure {
            constructor(x, y, isWhite) {
                super(x, y, isWhite, 'king')
            }
        }

        class Queen extends Figure {
            constructor(x, y, isWhite) {
                super(x, y, isWhite, "queen")
            }
        }
        class Knight extends Figure {
            constructor (x,y,isWhite){
                super(x,y,isWhite, 'knight')
            }
        }
        class Bishop extends Figure {
            constructor (x,y,isWhite){
                super(x,y,isWhite, 'bishop')
            }
        }
        let figures = []
        /* Pawns */
        for (let i=0; i<8;i++) {
            figures.push(new Pawn(i,1, true))
        }

        for (let i=0; i<8;i++) {
            figures.push(new Pawn(i,6, false))
        }
        /* Kings */
        figures.push(new King(4,0, true))

        figures.push(new King(4,7, false))
        /* Queens */
        figures.push(new Queen(3,0, true))

        figures.push(new Queen(3, 7, false))

        /* Rook */
        figures.push(new Rook(0,0, true))
        figures.push(new Rook(7,0, true))
        
        figures.push(new Rook(0,7, false))
        figures.push(new Rook(7,7, false))

        figures.push(new Knight(1,0, true))
        figures.push(new Knight(6,0, true))
        
        figures.push(new Knight(1,7, false))
        figures.push(new Knight(6,7, false))
        figures.push(new Bishop(2,0,true))
        figures.push(new Bishop(5,0,true))

        figures.push(new Bishop(2,7,false))
        figures.push(new Bishop(5,7,false))

        for (let i=0; i<figures.length;i++) {
            figures[i].draw()
        }

        let chooseFigure = null
        let last_cell = null

        for (let row = 0; row<rows.length; row++) {
            let cells = rows[row].querySelectorAll('div')
            for (let c = 0; c<cells.length; c++) {
                cells[c].addEventListener('click', function () {
                    if (board[c][7-row] != null) {
                        chooseFigure = board[c][7-row]
                        let row1 = rows[7-chooseFigure.y]
                        let div = row1.querySelectorAll('div')[chooseFigure.x]
                        let image = div.querySelector('img')
                        image.style.backgroundColor = '#0000FF'
                        last_cell = image
                        
                    } else {
                        if (chooseFigure != null) {
                            // DELETE FIGURE
                            board[chooseFigure.x][chooseFigure.y] = null
                            let row1 = rows[7-chooseFigure.y]
                            let div = row1.querySelectorAll('div')[chooseFigure.x]
                            let image = div.querySelector('img')
                            image.src = ''

                            // SET FIGURE TO NEW POSITION
                            chooseFigure.x = c
                            chooseFigure.y = 7-row
                            chooseFigure.draw()
                            board[c][7-row] = chooseFigure

                            chooseFigure = null
                            last_cell.style.opacity = 0
                            last_cell.style.backgroundColor = ''

                            

                        }

                    }
                    // alert(`x = ${c} y = ${7-row} isFigure = ${board[c][7-row]}`)

                })
            }

        }

    </script>
    </body>
    
</html>
